<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCRIPTRA</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="https://unpkg.com/@phosphor-icons/web@2.0.3"></script>

    <style>
        :root {
            --primary-color: #2E1065;
            --secondary-color: #A78BFA;
            --background-color: #f8f9fa;
            --card-background: #ffffff;
            --border-color: #e9ecef;
            --font-color: #343a40;
            --error-color: #dc3545;
            --green-color: #28a745;
            --red-color: #dc3545;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--font-color);
            line-height: 1.6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            width: 100%;
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            background-color: var(--card-background);
            border-radius: 12px;
        }
        .logo-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
        }
        .logo {
            width: 160px;
            height: 160px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: var(--primary-color);
        }
        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .nav-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
        }
        .nav-bar a {
            text-decoration: none;
            color: var(--primary-color);
            font-weight: bold;
            font-size: 1.1rem;
            padding: 5px 10px;
            border-radius: 5px;
            transition: color 0.2s ease, background-color 0.2s ease;
        }
        .nav-bar a:hover, .nav-bar a.active {
            color: var(--primary-color);
            background-color: var(--secondary-color);
        }
        .page {
            display: none;
            padding: 20px;
        }
        .page.active {
            display: block;
        }
        h1, h2 {
            text-align: center;
            color: var(--primary-color);
        }
        header {
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 20px;
        }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .creator-profile {
            text-align: center;
            padding: 30px 20px;
            background-color: var(--card-background);
            border-radius: 8px;
            margin-bottom: 25px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        #creator-profile-pic {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--primary-color);
            margin-bottom: 15px;
        }
        .social-links {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        .social-links a {
            color: var(--primary-color);
            font-size: 1.5rem;
            transition: transform 0.2s ease-in-out;
        }
        .social-links a:hover {
            transform: scale(1.1);
        }
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }
        .product-card {
            background-color: #fefefe;
            padding: 25px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: background-color 0.3s ease;
        }
        .product-card h3 {
            margin-top: 0;
            color: var(--primary-color);
        }
        .product-card p {
            margin: 5px 0;
        }
        .product-card .actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .product-card .actions button {
            flex: 1;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            border: none;
            color: white;
            transition: background-color 0.2s ease;
        }
        .product-card .actions button.edit-btn {
            background-color: var(--secondary-color);
        }
        .product-card .actions button.delete-btn {
            background-color: var(--red-color);
        }
        .product-card .actions button.edit-btn:hover {
            background-color: #9275d2;
        }
        .product-card .actions button.delete-btn:hover {
            background-color: #c82333;
        }
        .analytics-dashboard {
            padding: 25px;
            border-radius: 8px;
            background-color: #f4f7f9;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .stats-grid {
            display: flex;
            justify-content: space-around;
            gap: 20px;
        }
        .stat-item {
            text-align: center;
            font-size: 1.2rem;
            flex: 1;
            padding: 15px;
            background-color: var(--card-background);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        .stat-item .value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        .add-product-btn {
            background-color: var(--green-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.2s ease;
        }
        .add-product-btn:hover {
            background-color: #218838;
        }
        .auth-form {
            max-width: 400px;
            margin: 40px auto;
            padding: 40px;
            background-color: var(--card-background);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .auth-form h2 {
            text-align: center;
            margin-bottom: 20px;
        }
        .auth-form label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .auth-form input {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            box-sizing: border-box;
        }
        .auth-form button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 5px;
            background-color: var(--primary-color);
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
        }
        .auth-form p.switch-text {
            text-align: center;
            margin-top: 15px;
        }
        .auth-form p.switch-text a {
            color: var(--primary-color);
            text-decoration: none;
            cursor: pointer;
        }
        #error-message {
            color: var(--error-color);
            text-align: center;
            margin-bottom: 15px;
        }
        #logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: var(--secondary-color);
            color: var(--primary-color);
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        .modal {
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            display: none;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
        }
        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .chart-container {
            margin-bottom: 30px;
            background-color: var(--card-background);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }
        #confirm-modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        #confirm-modal-buttons button {
            padding: 10px 20px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
        }
        #confirm-modal-buttons #cancel-btn {
            background-color: var(--secondary-color);
            color: var(--primary-color);
        }
        #confirm-modal-buttons #confirm-btn {
            background-color: var(--red-color);
            color: white;
        }
        .social-links .ph {
            color: var(--primary-color);
        }
        /* New CSS for improved layout */
        .profile-form-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .profile-form-row {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        @media (min-width: 600px) {
            .profile-form-row {
                flex-direction: row;
            }
            .profile-form-row .form-field {
                flex: 1;
            }
        }
        .form-field {
            display: flex;
            flex-direction: column;
        }
        /* Styles for Brand Kit Page */
        .brand-kit-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .brand-kit-item {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            text-align: center;
            background-color: var(--card-background);
        }
        .brand-kit-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-bottom: 1px solid var(--border-color);
            background-color: #ddd; /* Placeholder background color */
            display: flex;
            justify-content: center;
            align-items: center;
            color: #888;
            font-size: 2rem;
        }
        .brand-kit-item h4 {
            color: var(--primary-color);
            margin: 15px 0 10px;
        }
        .brand-kit-item button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 15px;
        }

        /* Hamburger Menu Styles */
        .hamburger-menu {
            display: none;
            cursor: pointer;
            font-size: 2rem;
            color: var(--primary-color);
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10; /* Make sure it's above other content */
        }

        .nav-bar.mobile-active {
            display: flex;
            flex-direction: column;
            position: absolute;
            top: 60px; /* Adjust as needed */
            left: 0;
            width: 100%;
            background-color: var(--card-background);
            border-bottom: 2px solid var(--border-color);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            z-index: 9;
        }

        @media (max-width: 600px) {
            .nav-bar {
                display: none;
                border-bottom: none;
            }
            .hamburger-menu {
                display: block;
            }
            #logout-btn {
                top: 20px;
                right: 70px; /* Adjust to not overlap with hamburger */
            }
        }

        /* NEW CSS for Home Page */
        #home-page {
            text-align: center;
            padding: 50px 20px;
        }
        #home-page .hero-section {
            background-color: #f0f4f8;
            border-radius: 12px;
            padding: 40px 20px;
            margin-bottom: 40px;
        }
        #home-page h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        #home-page p {
            font-size: 1.2rem;
            color: var(--font-color);
            max-width: 600px;
            margin: 0 auto 30px;
        }
        .cta-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        .cta-buttons .cta-btn {
            padding: 12px 24px;
            font-size: 1rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            transition: transform 0.2s ease;
        }
        .cta-buttons .cta-btn:hover {
            transform: translateY(-2px);
        }
        #home-login-btn {
            background-color: var(--secondary-color);
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }
        #home-signup-btn {
            background-color: var(--primary-color);
            color: white;
            border: 2px solid var(--primary-color);
        }

        /* NEW CSS for brand kit output */
        #brand-kit-output {
            margin-top: 40px;
            padding: 20px;
            border: 2px dashed var(--secondary-color);
            border-radius: 12px;
            text-align: center;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        #brand-kit-output img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>

    <div class="container">

        <div id="home-page" class="page active">
            <div class="logo-container">
                <div class="logo">
                    <img src="b898d097-8db4-4854-abfa-b2b9c5397a89.jpeg" alt="Left Logo">
                </div>
                <div class="logo">
                    <img src="IMG_3895.png" alt="Right Logo">
                </div>
            </div>
            <div class="hero-section">
                <h1>Welcome to Scriptra</h1>
                <p>Monetize your creativity by effortlessly selling your digital products, tracking your growth, and building your brand.</p>
                <div class="cta-buttons">
                    <button id="home-signup-btn" class="cta-btn">Get Started</button>
                    <button id="home-login-btn" class="cta-btn">Log In</button>
                </div>
            </div>
            </div>

        <div id="login-page" class="page">
            <div class="logo-container">
                <div class="logo">
                    <img src="b898d097-8db4-4854-abfa-b2b9c5397a89.jpeg" alt="Left Logo">
                </div>
                <div class="logo">
                    <img src="IMG_3895.png" alt="Right Logo">
                </div>
            </div>
            <form id="login-form" class="auth-form">
                <h2>Log In</h2>
                <div id="login-error-message" style="color: var(--error-color); text-align: center; margin-bottom: 15px;"></div>
                <label for="login-username">Username</label>
                <input type="text" id="login-username" required>
                <label for="login-password">Password</label>
                <input type="password" id="login-password" required>
                <button type="submit">Log In</button>
                <p class="switch-text">Don't have an account? <a id="show-signup-btn">Sign Up</a></p>
            </form>
        </div>

        <div id="signup-page" class="page">
            <div class="logo-container">
                <div class="logo">
                    <img src="IMG_3895.png" alt="Left Logo">
                </div>
                <div class="logo">
                    <img src="b898d097-8db4-4854-abfa-b2b9c5397a89.jpeg" alt="Right Logo">
                </div>
            </div>
            <form id="signup-form" class="auth-form">
                <h2>Sign Up</h2>
                <div id="signup-error-message" style="color: var(--error-color); text-align: center; margin-bottom: 15px;"></div>
                <label for="signup-username">Username</label>
                <input type="text" id="signup-username" required>
                <label for="signup-password">Password</label>
                <input type="password" id="signup-password" required>
                <button type="submit">Sign Up</button>
                <p class="switch-text">Already have an account? <a id="show-login-btn">Log In</a></p>
            </form>
        </div>

        <div id="auth-views" style="display: none;">
            <button id="logout-btn">Log Out</button>
            <div class="hamburger-menu" id="hamburger-icon"><i class="ph ph-list"></i></div>

            <div class="logo-container">
                <div class="logo">
                    <img src="b898d097-8db4-4854-abfa-b2b9c5397a89.jpeg" alt="Left Logo">
                </div>
                <div class="logo">
                    <img src="IMG_3895.png" alt="Right Logo">
                </div>
            </div>

            <nav class="nav-bar">
                <a href="#" id="nav-dashboard" class="active">Dashboard</a>
                <a href="#" id="nav-products">My Products</a>
                <a href="#" id="nav-analytics">Analytics</a>
                <a href="#" id="nav-brand-kit">Brand Kit</a>
            </nav>

            <div id="dashboard-page" class="page active">
                <header>
                    <h1>My Creator Dashboard</h1>
                    <p><b>Welcome to Scriptra</b></p>
                </header>

                <section class="creator-profile">
                    <img id="creator-profile-pic" src="https://picsum.photos/seed/profile/120/120" alt="Creator Profile Picture">
                    <h2 id="creator-name"></h2>
                    <p id="creator-bio"></p>
                    <div id="social-links-container" class="social-links"></div>
                </section>

                <section>
                    <div class="section-header">
                        <h2>Edit Profile</h2>
                        <button id="save-profile-btn" class="add-product-btn">Save Profile</button>
                    </div>
                    <div class="profile-form-group">
                        <div class="profile-form-row">
                            <div class="form-field">
                                <label for="profile-name">Name</label>
                                <input type="text" id="profile-name" required>
                            </div>
                            <div class="form-field">
                                <label for="profile-bio">Bio</label>
                                <textarea id="profile-bio" rows="4"></textarea>
                            </div>
                        </div>
                        <div class="form-field">
                            <label for="profile-photo-upload" style="display: inline-block; padding: 10px 15px; background-color: var(--secondary-color); color: var(--primary-color); border-radius: 5px; cursor: pointer; margin-top: 10px; text-align: center;">
                                Upload New Photo
                            </label>
                            <input type="file" id="profile-photo-upload" style="display: none;" accept="image/*">
                        </div>
                        <h3 style="margin-top: 20px;">Social Media</h3>
                        <div class="profile-form-row">
                            <div class="form-field">
                                <label for="social-twitter">Twitter</label>
                                <input type="text" id="social-twitter" placeholder="@handle">
                            </div>
                            <div class="form-field">
                                <label for="social-instagram">Instagram</label>
                                <input type="text" id="social-instagram" placeholder="@handle">
                            </div>
                            <div class="form-field">
                                <label for="social-linkedin">LinkedIn</label>
                                <input type="text" id="social-linkedin" placeholder="/username">
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <div id="products-page" class="page">
                <header>
                    <h1>My Products</h1>
                </header>
                <div class="section-header">
                    <h2>Manage Products</h2>
                    <button id="add-product-btn" class="add-product-btn">Add Product</button>
                </div>
                <div id="product-list" class="product-grid"></div>
            </div>

            <div id="analytics-page" class="page">
                <header>
                    <h1>Analytics Dashboard</h1>
                </header>
                <section class="analytics-dashboard">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="value" id="total-sales">0</div>
                            <p>Total Sales</p>
                        </div>
                        <div class="stat-item">
                            <div class="value" id="total-revenue">$0</div>
                            <p>Total Revenue</p>
                        </div>
                        <div class="stat-item">
                            <div class="value" id="total-products">0</div>
                            <p>Products</p>
                        </div>
                    </div>
                </section>
                <hr style="margin: 40px 0;">
                <section>
                    <div class="chart-container">
                        <h2>Daily Revenue</h2>
                        <canvas id="revenueChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h2>Sales per Product</h2>
                        <canvas id="salesChart"></canvas>
                    </div>
                </section>
            </div>

            <div id="brand-kit-page" class="page">
                <header>
                    <h1>Brand Kit Generator</h1>
                    <p>Generate marketing assets for your brand using these templates.</p>
                </header>

                <h2>Templates</h2>
                <div class="brand-kit-grid">
                    <div class="brand-kit-item">
                        <img src="https://picsum.photos/seed/banner/500/300" alt="Profile Banner Template">
                        <h4>Profile Banner</h4>
                        <button onclick="generateBanner()">Generate</button>
                    </div>
                    <div class="brand-kit-item">
                        <img src="https://picsum.photos/seed/socialpost/500/500" alt="Social Post Template">
                        <h4>Social Post</h4>
                        <button onclick="generateSocialPost()">Generate</button>
                    </div>
                    <div class="brand-kit-item">
                        <img src="https://picsum.photos/seed/product/500/400" alt="Product Thumbnail Template">
                        <h4>Product Thumbnail</h4>
                        <button onclick="generateThumbnail()">Generate</button>
                    </div>
                </div>

                <div id="brand-kit-output">
                    <p>Generated image will appear here...</p>
                </div>
            </div>
        </div>
    </div>

    <div id="universal-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2 id="modal-title"></h2>

            <form id="edit-product-form">
                <input type="hidden" id="edit-product-id">
                <label for="edit-product-name">Product Name</label>
                <input type="text" id="edit-product-name" required>
                <label for="edit-product-description">Description</label>
                <input type="text" id="edit-product-description" required>
                <label for="edit-product-price">Price ($)</label>
                <input type="number" id="edit-product-price" step="0.01" required>
                <label for="edit-product-color">Card Color</label>
                <input type="color" id="edit-product-color" value="#ffffff" required>
                <button type="submit">Save Changes</button>
            </form>

            <div id="confirm-modal-content" style="display: none;">
                <p id="confirm-modal-message"></p>
                <div id="confirm-modal-buttons">
                    <button id="cancel-btn">Cancel</button>
                    <button id="confirm-btn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. DATA MANAGEMENT & STATE ---
        const LOCAL_STORAGE_KEY = 'creatorUsers';
        const defaultProfilePic = "https://picsum.photos/seed/profile/120/120";
        let myRevenueChart;
        let mySalesChart;

        function getUsers() {
            const users = localStorage.getItem(LOCAL_STORAGE_KEY);
            return users ? JSON.parse(users) : [];
        }

        function saveUsers(users) {
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(users));
        }

        function getCurrentUser() {
            const users = getUsers();
            const currentUsername = localStorage.getItem('currentUser');
            return users.find(u => u.username === currentUsername) || null;
        }

        function saveCurrentUserProfile(profileData) {
            const users = getUsers();
            const currentUser = getCurrentUser();
            if (!currentUser) return;

            const userIndex = users.findIndex(u => u.username === currentUser.username);
            if (userIndex !== -1) {
                users[userIndex].storefront.profile = profileData;
                saveUsers(users);
            }
        }

        // --- 2. VIEW MANAGEMENT ---
        const homePage = document.getElementById('home-page');
        const loginPage = document.getElementById('login-page');
        const signupPage = document.getElementById('signup-page');
        const authViews = document.getElementById('auth-views');
        const dashboardPage = document.getElementById('dashboard-page');
        const productsPage = document.getElementById('products-page');
        const analyticsPage = document.getElementById('analytics-page');
        const brandKitPage = document.getElementById('brand-kit-page');
        const navDashboard = document.getElementById('nav-dashboard');
        const navProducts = document.getElementById('nav-products');
        const navAnalytics = document.getElementById('nav-analytics');
        const navBrandKit = document.getElementById('nav-brand-kit');
        const universalModal = document.getElementById('universal-modal');
        const editProductForm = document.getElementById('edit-product-form');
        const confirmModalContent = document.getElementById('confirm-modal-content');
        const modalTitle = document.getElementById('modal-title');
        const brandKitOutput = document.getElementById('brand-kit-output');

        function showView(viewName) {
            homePage.classList.remove('active');
            loginPage.classList.remove('active');
            signupPage.classList.remove('active');
            dashboardPage.classList.remove('active');
            productsPage.classList.remove('active');
            analyticsPage.classList.remove('active');
            brandKitPage.classList.remove('active');
            authViews.style.display = 'none';

            navDashboard.classList.remove('active');
            navProducts.classList.remove('active');
            navAnalytics.classList.remove('active');
            navBrandKit.classList.remove('active');

            if (viewName === 'home') {
                homePage.classList.add('active');
            } else if (viewName === 'login') {
                loginPage.classList.add('active');
            } else if (viewName === 'signup') {
                signupPage.classList.add('active');
            } else {
                authViews.style.display = 'block';
                if (viewName === 'dashboard') {
                    dashboardPage.classList.add('active');
                    navDashboard.classList.add('active');
                    renderDashboard();
                } else if (viewName === 'products') {
                    productsPage.classList.add('active');
                    navProducts.classList.add('active');
                    renderProducts();
                } else if (viewName === 'analytics') {
                    analyticsPage.classList.add('active');
                    navAnalytics.classList.add('active');
                    renderAnalytics();
                } else if (viewName === 'brand-kit') {
                    brandKitPage.classList.add('active');
                    navBrandKit.classList.add('active');
                }
            }
        }

        // --- 3. AUTHENTICATION LOGIC ---
        // NEW: Event listeners for home page CTA buttons
        document.getElementById('home-login-btn').addEventListener('click', () => showView('login'));
        document.getElementById('home-signup-btn').addEventListener('click', () => showView('signup'));

        // Existing event listeners
        document.getElementById('show-signup-btn').addEventListener('click', () => showView('signup'));
        document.getElementById('show-login-btn').addEventListener('click', () => showView('login'));
        document.getElementById('logout-btn').addEventListener('click', () => {
            localStorage.removeItem('currentUser');
            showView('home'); // Redirect to home page on logout
        });

        document.getElementById('signup-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const username = this.querySelector('#signup-username').value;
            const password = this.querySelector('#signup-password').value;
            const users = getUsers();
            const errorMessage = document.getElementById('signup-error-message');

            if (users.some(u => u.username === username)) {
                errorMessage.textContent = 'Username already exists.';
                return;
            }

            const newUser = {
                username: username,
                password: password,
                storefront: {
                    profile: {  
                        name: username,  
                        bio: `Hello! I'm ${username}, and this is my creator storefront.`,  
                        profilePic: defaultProfilePic,
                        socialMedia: { twitter: '', instagram: '', linkedin: '' }
                    },
                    products: [],
                    analytics: { sales: 0, revenue: 0, clicks: 0 }
                }
            };
            users.push(newUser);
            saveUsers(users);
            localStorage.setItem('currentUser', username);
            showView('dashboard');
        });

        document.getElementById('login-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const username = this.querySelector('#login-username').value;
            const password = this.querySelector('#login-password').value;
            const users = getUsers();
            const errorMessage = document.getElementById('login-error-message');

            const user = users.find(u => u.username === username && u.password === password);

            if (user) {
                localStorage.setItem('currentUser', username);
                showView('dashboard');
            } else {
                errorMessage.textContent = 'Invalid username or password.';
            }
        });

        // Navigation bar event listeners
        navDashboard.addEventListener('click', () => showView('dashboard'));
        navProducts.addEventListener('click', () => showView('products'));
        navAnalytics.addEventListener('click', () => showView('analytics'));
        navBrandKit.addEventListener('click', () => showView('brand-kit'));

        // --- 4. DASHBOARD & PRODUCTS LOGIC ---
        function renderDashboard() {
            const user = getCurrentUser();
            if (!user) return;
            const data = user.storefront;

            // Render Profile Section
            document.getElementById('creator-name').textContent = data.profile.name;
            document.getElementById('creator-bio').textContent = data.profile.bio;
            document.getElementById('creator-profile-pic').src = data.profile.profilePic;

            // Render Social Media Links
            const socialLinksContainer = document.getElementById('social-links-container');
            socialLinksContainer.innerHTML = '';
            if (data.profile.socialMedia.twitter) {
                socialLinksContainer.innerHTML += `<a href="https://twitter.com/${data.profile.socialMedia.twitter}" target="_blank"><i class="ph ph-twitter-logo"></i></a>`;
            }
            if (data.profile.socialMedia.instagram) {
                socialLinksContainer.innerHTML += `<a href="https://instagram.com/${data.profile.socialMedia.instagram}" target="_blank"><i class="ph ph-instagram-logo"></i></a>`;
            }
            if (data.profile.socialMedia.linkedin) {
                socialLinksContainer.innerHTML += `<a href="https://linkedin.com/in/${data.profile.socialMedia.linkedin}" target="_blank"><i class="ph ph-linkedin-logo"></i></a>`;
            }

            // Set up profile edit form with current data
            document.getElementById('profile-name').value = data.profile.name;
            document.getElementById('profile-bio').value = data.profile.bio;
            document.getElementById('social-twitter').value = data.profile.socialMedia.twitter;
            document.getElementById('social-instagram').value = data.profile.socialMedia.instagram;
            document.getElementById('social-linkedin').value = data.profile.socialMedia.linkedin;
        }

        // Save Profile function
        document.getElementById('save-profile-btn').addEventListener('click', () => {
            const profileName = document.getElementById('profile-name').value;
            const profileBio = document.getElementById('profile-bio').value;
            const socialTwitter = document.getElementById('social-twitter').value;
            const socialInstagram = document.getElementById('social-instagram').value;
            const socialLinkedin = document.getElementById('social-linkedin').value;
            const profilePicUrl = document.getElementById('creator-profile-pic').src; // Retain current image URL

            const newProfileData = {
                name: profileName,
                bio: profileBio,
                profilePic: profilePicUrl,
                socialMedia: {
                    twitter: socialTwitter,
                    instagram: socialInstagram,
                    linkedin: socialLinkedin
                }
            };

            saveCurrentUserProfile(newProfileData);
            renderDashboard(); // Re-render the dashboard to show the changes immediately
            alert('Profile saved!');
        });

        document.getElementById('profile-photo-upload').addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const profilePic = document.getElementById('creator-profile-pic');
                    profilePic.src = e.target.result;
                    // Auto-save the profile picture change
                    const user = getCurrentUser();
                    if (user) {
                        user.storefront.profile.profilePic = e.target.result;
                        saveUsers(getUsers().map(u => u.username === user.username ? user : u));
                        alert('Profile picture updated!');
                    }
                };
                reader.readAsDataURL(file);
            }
        });

        function renderProducts() {
            const user = getCurrentUser();
            if (!user) return;
            const data = user.storefront;

            const productListDiv = document.getElementById('product-list');
            productListDiv.innerHTML = ''; // Clear the list before re-rendering
            if (data.products.length === 0) {
                productListDiv.innerHTML = '<p style="text-align: center; color: var(--font-color);">You have no products yet. Click "Add Product" to create your first one!</p>';
            } else {
                data.products.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'product-card';
                    if (product.branding && product.branding.color) {
                        productCard.style.backgroundColor = product.branding.color;
                    }
                    productCard.innerHTML = `
                        <h3>${product.name}</h3>
                        <p>${product.description}</p>
                        <p style="font-weight: bold;">$${product.price.toFixed(2)}</p>
                        <div class="actions">
                            <button class="edit-btn" data-product-id="${product.id}">Edit</button>
                            <button class="delete-btn" data-product-id="${product.id}">Delete</button>
                        </div>
                    `;
                    productListDiv.appendChild(productCard);
                });
            }
        }

        // --- 5. ANALYTICS LOGIC ---
        function renderAnalytics() {
            const user = getCurrentUser();
            if (!user) return;
            const data = user.storefront;

            // Render top stats
            document.getElementById('total-sales').textContent = data.analytics.sales;
            document.getElementById('total-revenue').textContent = data.analytics.revenue.toFixed(2);
            document.getElementById('total-products').textContent = data.products.length;

            // Destroy existing charts to prevent stacking
            if (myRevenueChart) myRevenueChart.destroy();
            if (mySalesChart) mySalesChart.destroy();

            // Render revenue chart
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            myRevenueChart = new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7'],
                    datasets: [{
                        label: 'Revenue ($)',
                        data: generateRandomData(7, 50, 200),
                        borderColor: varColor('--primary-color'),
                        tension: 0.4,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Render sales per product chart
            const salesCtx = document.getElementById('salesChart').getContext('2d');
            const productNames = data.products.length > 0 ? data.products.map(p => p.name) : ['Product 1', 'Product 2', 'Product 3'];
            mySalesChart = new Chart(salesCtx, {
                type: 'bar',
                data: {
                    labels: productNames,
                    datasets: [{
                        label: 'Sales',
                        data: generateRandomData(productNames.length, 5, 50),
                        backgroundColor: productNames.map(() => varColor('--secondary-color'))
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // --- 6. BRAND KIT LOGIC ---
        function generateBanner() {
            brandKitOutput.innerHTML = `<p>Generating your profile banner...</p>`;
            setTimeout(() => {
                brandKitOutput.innerHTML = `
                    <p>Here is your generated profile banner!</p>
                    http://googleusercontent.com/image_generation_content/3
                `;
            }, 1000);
        }

        function generateSocialPost() {
            brandKitOutput.innerHTML = `<p>Generating your social media post...</p>`;
            setTimeout(() => {
                brandKitOutput.innerHTML = `
                    <p>Here is your generated social post!</p>
                    http://googleusercontent.com/image_generation_content/1
                `;
            }, 1000);
        }

        function generateThumbnail() {
            brandKitOutput.innerHTML = `<p>Generating your product thumbnail...</p>`;
            setTimeout(() => {
                brandKitOutput.innerHTML = `
                    <p>Here is your generated product thumbnail!</p>
                    http://googleusercontent.com/image_generation_content/2
                `;
            }, 1000);
        }

        // --- 7. UTILITY FUNCTIONS & EVENT LISTENERS (continued) ---

        // Function to get CSS variable value
        function varColor(name) {
            return getComputedStyle(document.documentElement).getPropertyValue(name);
        }

        // Function to generate random data for charts
        function generateRandomData(count, min, max) {
            const data = [];
            for (let i = 0; i < count; i++) {
                data.push(Math.floor(Math.random() * (max - min + 1)) + min);
            }
            return data;
        }

        // Modal functionality
        const modal = document.getElementById('universal-modal');
        const closeModalBtn = document.querySelector('.close-btn');

        closeModalBtn.onclick = function() {
            modal.style.display = "none";
            editProductForm.style.display = 'block';
            confirmModalContent.style.display = 'none';
        }

        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
                editProductForm.style.display = 'block';
                confirmModalContent.style.display = 'none';
            }
        }

        // Event listener for "Add Product" button
        document.getElementById('add-product-btn').addEventListener('click', () => {
            modal.style.display = "flex";
            modalTitle.textContent = "Add New Product";
            editProductForm.style.display = 'block';
            confirmModalContent.style.display = 'none';
            document.getElementById('edit-product-id').value = '';
            document.getElementById('edit-product-name').value = '';
            document.getElementById('edit-product-description').value = '';
            document.getElementById('edit-product-price').value = '';
            document.getElementById('edit-product-color').value = '#ffffff';
        });

        // Event listener for edit/delete buttons on product cards
        document.getElementById('product-list').addEventListener('click', (event) => {
            const btn = event.target;
            const productId = parseInt(btn.dataset.productId);
            const user = getCurrentUser();
            if (!user) return;

            const product = user.storefront.products.find(p => p.id === productId);

            if (btn.classList.contains('edit-btn')) {
                modal.style.display = "flex";
                modalTitle.textContent = "Edit Product";
                editProductForm.style.display = 'block';
                confirmModalContent.style.display = 'none';
                document.getElementById('edit-product-id').value = product.id;
                document.getElementById('edit-product-name').value = product.name;
                document.getElementById('edit-product-description').value = product.description;
                document.getElementById('edit-product-price').value = product.price;
                if (product.branding && product.branding.color) {
                    document.getElementById('edit-product-color').value = product.branding.color;
                }
            } else if (btn.classList.contains('delete-btn')) {
                modal.style.display = "flex";
                modalTitle.textContent = "Confirm Deletion";
                editProductForm.style.display = 'none';
                confirmModalContent.style.display = 'block';
                document.getElementById('confirm-modal-message').textContent = `Are you sure you want to delete "${product.name}"?`;
                document.getElementById('confirm-btn').onclick = () => {
                    user.storefront.products = user.storefront.products.filter(p => p.id !== productId);
                    saveUsers(getUsers().map(u => u.username === user.username ? user : u));
                    modal.style.display = "none";
                    renderProducts();
                };
            }
        });

        // Event listener for modal form submission
        editProductForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const id = document.getElementById('edit-product-id').value;
            const name = document.getElementById('edit-product-name').value;
            const description = document.getElementById('edit-product-description').value;
            const price = parseFloat(document.getElementById('edit-product-price').value);
            const color = document.getElementById('edit-product-color').value;

            const user = getCurrentUser();
            if (!user) return;

            if (id) {
                // Editing an existing product
                const product = user.storefront.products.find(p => p.id == id);
                if (product) {
                    product.name = name;
                    product.description = description;
                    product.price = price;
                    product.branding = { color };
                }
            } else {
                // Adding a new product
                const newProduct = {
                    id: Date.now(), // Simple unique ID
                    name,
                    description,
                    price,
                    branding: { color }
                };
                user.storefront.products.push(newProduct);
            }

            saveUsers(getUsers().map(u => u.username === user.username ? user : u));
            modal.style.display = "none";
            renderProducts();
        });

        // Initial check on page load
        document.addEventListener('DOMContentLoaded', () => {
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                showView('dashboard');
            } else {
                showView('home');
            }

            // Hamburger menu functionality
            const hamburgerIcon = document.getElementById('hamburger-icon');
            const navBar = document.querySelector('.nav-bar');
            const navLinks = document.querySelectorAll('.nav-bar a');

            hamburgerIcon.addEventListener('click', () => {
                navBar.classList.toggle('mobile-active');
            });

            // Close menu when a link is clicked
            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    navBar.classList.remove('mobile-active');
                });
            });
        });
    </script>
</body>
</html>
